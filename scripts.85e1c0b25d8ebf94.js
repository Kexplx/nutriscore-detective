!function(N){"object"==typeof exports&&"undefined"!=typeof module?module.exports=N():"function"==typeof define&&define.amd?define([],N):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).adapter=N()}(function(){return function k(I,g,_){function u(o,f){if(!g[o]){if(!I[o]){var C="function"==typeof require&&require;if(!f&&C)return C(o,!0);if(a)return a(o,!0);var R=new Error("Cannot find module '"+o+"'");throw R.code="MODULE_NOT_FOUND",R}var T=g[o]={exports:{}};I[o][0].call(T.exports,function(P){return u(I[o][1][P]||P)},T,T.exports,k,I,g,_)}return g[o].exports}for(var a="function"==typeof require&&require,i=0;i<_.length;i++)u(_[i]);return u}({1:[function(k,I,g){"use strict";var u=(0,k("./adapter_factory.js").adapterFactory)({window:"undefined"==typeof window?void 0:window});I.exports=u},{"./adapter_factory.js":2}],2:[function(k,I,g){"use strict";Object.defineProperty(g,"__esModule",{value:!0}),g.adapterFactory=function(){var c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=c.window,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0},t=u.log,r=u.detectBrowser(n),s={browserDetails:r,commonShim:P,extractVersion:u.extractVersion,disableLog:u.disableLog,disableWarnings:u.disableWarnings,sdp:O};switch(r.browser){case"chrome":if(!i||!i.shimPeerConnection||!e.shimChrome)return t("Chrome shim is not included in this adapter release."),s;if(null===r.version)return t("Chrome shim can not determine version, not shimming."),s;t("adapter.js shimming chrome."),s.browserShim=i,P.shimAddIceCandidateNullOrEmpty(n,r),P.shimParameterlessSetLocalDescription(n,r),i.shimGetUserMedia(n,r),i.shimMediaStream(n,r),i.shimPeerConnection(n,r),i.shimOnTrack(n,r),i.shimAddTrackRemoveTrack(n,r),i.shimGetSendersWithDtmf(n,r),i.shimGetStats(n,r),i.shimSenderReceiverGetStats(n,r),i.fixNegotiationNeeded(n,r),P.shimRTCIceCandidate(n,r),P.shimConnectionState(n,r),P.shimMaxMessageSize(n,r),P.shimSendThrowTypeError(n,r),P.removeExtmapAllowMixed(n,r);break;case"firefox":if(!f||!f.shimPeerConnection||!e.shimFirefox)return t("Firefox shim is not included in this adapter release."),s;t("adapter.js shimming firefox."),s.browserShim=f,P.shimAddIceCandidateNullOrEmpty(n,r),P.shimParameterlessSetLocalDescription(n,r),f.shimGetUserMedia(n,r),f.shimPeerConnection(n,r),f.shimOnTrack(n,r),f.shimRemoveStream(n,r),f.shimSenderGetStats(n,r),f.shimReceiverGetStats(n,r),f.shimRTCDataChannel(n,r),f.shimAddTransceiver(n,r),f.shimGetParameters(n,r),f.shimCreateOffer(n,r),f.shimCreateAnswer(n,r),P.shimRTCIceCandidate(n,r),P.shimConnectionState(n,r),P.shimMaxMessageSize(n,r),P.shimSendThrowTypeError(n,r);break;case"safari":if(!R||!e.shimSafari)return t("Safari shim is not included in this adapter release."),s;t("adapter.js shimming safari."),s.browserShim=R,P.shimAddIceCandidateNullOrEmpty(n,r),P.shimParameterlessSetLocalDescription(n,r),R.shimRTCIceServerUrls(n,r),R.shimCreateOfferLegacy(n,r),R.shimCallbacksAPI(n,r),R.shimLocalStreamsAPI(n,r),R.shimRemoteStreamsAPI(n,r),R.shimTrackEventTransceiver(n,r),R.shimGetUserMedia(n,r),R.shimAudioContext(n,r),P.shimRTCIceCandidate(n,r),P.shimMaxMessageSize(n,r),P.shimSendThrowTypeError(n,r),P.removeExtmapAllowMixed(n,r);break;default:t("Unsupported browser!")}return s};var u=M(k("./utils")),i=M(k("./chrome/chrome_shim")),f=M(k("./firefox/firefox_shim")),R=M(k("./safari/safari_shim")),P=M(k("./common_shim")),O=M(k("sdp"));function M(c){if(c&&c.__esModule)return c;var n={};if(null!=c)for(var e in c)Object.prototype.hasOwnProperty.call(c,e)&&(n[e]=c[e]);return n.default=c,n}},{"./chrome/chrome_shim":3,"./common_shim":6,"./firefox/firefox_shim":7,"./safari/safari_shim":10,"./utils":11,sdp:12}],3:[function(k,I,g){"use strict";Object.defineProperty(g,"__esModule",{value:!0}),g.shimGetDisplayMedia=g.shimGetUserMedia=void 0;var _="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u=k("./getusermedia");Object.defineProperty(g,"shimGetUserMedia",{enumerable:!0,get:function(){return u.shimGetUserMedia}});var a=k("./getdisplaymedia");Object.defineProperty(g,"shimGetDisplayMedia",{enumerable:!0,get:function(){return a.shimGetDisplayMedia}}),g.shimMediaStream=function(e){e.MediaStream=e.MediaStream||e.webkitMediaStream},g.shimOnTrack=function(e){if("object"===(void 0===e?"undefined":_(e))&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(s){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=s)},enumerable:!0,configurable:!0});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var s=this;return this._ontrackpoly||(this._ontrackpoly=function(l){l.stream.addEventListener("addtrack",function(h){var m;m=e.RTCPeerConnection.prototype.getReceivers?s.getReceivers().find(function(v){return v.track&&v.track.id===h.track.id}):{track:h.track};var d=new Event("track");d.track=h.track,d.receiver=m,d.transceiver={receiver:m},d.streams=[l.stream],s.dispatchEvent(d)}),l.stream.getTracks().forEach(function(h){var m;m=e.RTCPeerConnection.prototype.getReceivers?s.getReceivers().find(function(v){return v.track&&v.track.id===h.id}):{track:h};var d=new Event("track");d.track=h,d.receiver=m,d.transceiver={receiver:m},d.streams=[l.stream],s.dispatchEvent(d)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else o.wrapPeerConnectionEvent(e,"track",function(r){return r.transceiver||Object.defineProperty(r,"transceiver",{value:{receiver:r.receiver}}),r})},g.shimGetSendersWithDtmf=function(e){if("object"===(void 0===e?"undefined":_(e))&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){var t=function(v,y){return{track:y,get dtmf(){return void 0===this._dtmf&&(this._dtmf="audio"===y.kind?v.createDTMFSender(y):null),this._dtmf},_pc:v}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};var r=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(v,y){var S=r.apply(this,arguments);return S||(S=t(this,v),this._senders.push(S)),S};var s=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(v){s.apply(this,arguments);var y=this._senders.indexOf(v);-1!==y&&this._senders.splice(y,1)}}var l=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(v){var y=this;this._senders=this._senders||[],l.apply(this,[v]),v.getTracks().forEach(function(S){y._senders.push(t(y,S))})};var h=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(v){var y=this;this._senders=this._senders||[],h.apply(this,[v]),v.getTracks().forEach(function(S){var E=y._senders.find(function(b){return b.track===S});E&&y._senders.splice(y._senders.indexOf(E),1)})}}else if("object"===(void 0===e?"undefined":_(e))&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){var m=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){var v=this,y=m.apply(this,[]);return y.forEach(function(S){return S._pc=v}),y},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&(this._dtmf="audio"===this.track.kind?this._pc.createDTMFSender(this.track):null),this._dtmf}})}},g.shimGetStats=function(e){if(e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){var s=this,l=Array.prototype.slice.call(arguments),h=l[0],m=l[1],d=l[2];if(arguments.length>0&&"function"==typeof h)return t.apply(this,arguments);if(0===t.length&&(0===arguments.length||"function"!=typeof h))return t.apply(this,[]);var v=function(b){var D={};return b.result().forEach(function(L){var G={id:L.id,timestamp:L.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[L.type]||L.type};L.names().forEach(function(U){G[U]=L.stat(U)}),D[G.id]=G}),D},y=function(b){return new Map(Object.keys(b).map(function(D){return[D,b[D]]}))};if(arguments.length>=2){var S=function(b){m(y(v(b)))};return t.apply(this,[S,h])}return new Promise(function(E,b){t.apply(s,[function(D){E(y(v(D)))},b])}).then(m,d)}}},g.shimSenderReceiverGetStats=function(e){if("object"===(void 0===e?"undefined":_(e))&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver){if(!("getStats"in e.RTCRtpSender.prototype)){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){var m=this,d=t.apply(this,[]);return d.forEach(function(v){return v._pc=m}),d});var r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){var m=r.apply(this,arguments);return m._pc=this,m}),e.RTCRtpSender.prototype.getStats=function(){var m=this;return this._pc.getStats().then(function(d){return o.filterStats(d,m.track,!0)})}}if(!("getStats"in e.RTCRtpReceiver.prototype)){var s=e.RTCPeerConnection.prototype.getReceivers;s&&(e.RTCPeerConnection.prototype.getReceivers=function(){var m=this,d=s.apply(this,[]);return d.forEach(function(v){return v._pc=m}),d}),o.wrapPeerConnectionEvent(e,"track",function(h){return h.receiver._pc=h.srcElement,h}),e.RTCRtpReceiver.prototype.getStats=function(){var m=this;return this._pc.getStats().then(function(d){return o.filterStats(d,m.track,!1)})}}if("getStats"in e.RTCRtpSender.prototype&&"getStats"in e.RTCRtpReceiver.prototype){var l=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){var m=arguments[0],d=void 0,v=void 0,y=void 0;return this.getSenders().forEach(function(S){S.track===m&&(d?y=!0:d=S)}),this.getReceivers().forEach(function(S){return S.track===m&&(v?y=!0:v=S),S.track===m}),y||d&&v?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):d?d.getStats():v?v.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return l.apply(this,arguments)}}}},g.shimAddTrackRemoveTrackWithNative=M,g.shimAddTrackRemoveTrack=function(e,t){if(e.RTCPeerConnection){if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return M(e);var r=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){var S=this,E=r.apply(this);return this._reverseStreams=this._reverseStreams||{},E.map(function(b){return S._reverseStreams[b.id]})};var s=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(S){var E=this;if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},S.getTracks().forEach(function(D){if(E.getSenders().find(function(L){return L.track===D}))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[S.id]){var b=new e.MediaStream(S.getTracks());this._streams[S.id]=b,this._reverseStreams[b.id]=S,S=b}s.apply(this,[S])};var l=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(S){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},l.apply(this,[this._streams[S.id]||S]),delete this._reverseStreams[this._streams[S.id]?this._streams[S.id].id:S.id],delete this._streams[S.id]},e.RTCPeerConnection.prototype.addTrack=function(S,E){var b=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var D=[].slice.call(arguments,1);if(1!==D.length||!D[0].getTracks().find(function(U){return U===S}))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");var A=this.getSenders().find(function(U){return U.track===S});if(A)throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};var L=this._streams[E.id];if(L)L.addTrack(S),Promise.resolve().then(function(){b.dispatchEvent(new Event("negotiationneeded"))});else{var G=new e.MediaStream([S]);this._streams[E.id]=G,this._reverseStreams[G.id]=E,this.addStream(G)}return this.getSenders().find(function(U){return U.track===S})},["createOffer","createAnswer"].forEach(function(y){var S=e.RTCPeerConnection.prototype[y],E=C({},y,function(){var b=this,D=arguments,A=arguments.length&&"function"==typeof arguments[0];return A?S.apply(this,[function(L){var G=h(b,L);D[0].apply(null,[G])},function(L){D[1]&&D[1].apply(null,L)},arguments[2]]):S.apply(this,arguments).then(function(L){return h(b,L)})});e.RTCPeerConnection.prototype[y]=E[y]});var d=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=m(this,arguments[0]),d.apply(this,arguments)):d.apply(this,arguments)};var v=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get:function(){var S=v.get.apply(this);return""===S.type?S:h(this,S)}}),e.RTCPeerConnection.prototype.removeTrack=function(S){var E=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!S._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(S._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};var D=void 0;Object.keys(this._streams).forEach(function(A){E._streams[A].getTracks().find(function(G){return S.track===G})&&(D=E._streams[A])}),D&&(1===D.getTracks().length?this.removeStream(this._reverseStreams[D.id]):D.removeTrack(S.track),this.dispatchEvent(new Event("negotiationneeded")))}}function h(y,S){var E=S.sdp;return Object.keys(y._reverseStreams||[]).forEach(function(b){var D=y._reverseStreams[b];E=E.replace(new RegExp(y._streams[D.id].id,"g"),D.id)}),new RTCSessionDescription({type:S.type,sdp:E})}function m(y,S){var E=S.sdp;return Object.keys(y._reverseStreams||[]).forEach(function(b){var D=y._reverseStreams[b],A=y._streams[D.id];E=E.replace(new RegExp(D.id,"g"),A.id)}),new RTCSessionDescription({type:S.type,sdp:E})}},g.shimPeerConnection=function(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(r){var s=e.RTCPeerConnection.prototype[r],l=C({},r,function(){return arguments[0]=new("addIceCandidate"===r?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),s.apply(this,arguments)});e.RTCPeerConnection.prototype[r]=l[r]})},g.fixNegotiationNeeded=function(e,t){o.wrapPeerConnectionEvent(e,"negotiationneeded",function(r){var s=r.target;if(!(t.version<72||s.getConfiguration&&"plan-b"===s.getConfiguration().sdpSemantics)||"stable"===s.signalingState)return r})};var o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(k("../utils.js"));function C(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function M(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){var m=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(function(d){return m._shimmedLocalStreams[d][0]})};var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(m,d){if(!d)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var v=t.apply(this,arguments);return this._shimmedLocalStreams[d.id]?-1===this._shimmedLocalStreams[d.id].indexOf(v)&&this._shimmedLocalStreams[d.id].push(v):this._shimmedLocalStreams[d.id]=[d,v],v};var r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(m){var d=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{},m.getTracks().forEach(function(S){if(d.getSenders().find(function(b){return b.track===S}))throw new DOMException("Track already exists.","InvalidAccessError")});var v=this.getSenders();r.apply(this,arguments);var y=this.getSenders().filter(function(S){return-1===v.indexOf(S)});this._shimmedLocalStreams[m.id]=[m].concat(y)};var s=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(m){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[m.id],s.apply(this,arguments)};var l=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(m){var d=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},m&&Object.keys(this._shimmedLocalStreams).forEach(function(v){var y=d._shimmedLocalStreams[v].indexOf(m);-1!==y&&d._shimmedLocalStreams[v].splice(y,1),1===d._shimmedLocalStreams[v].length&&delete d._shimmedLocalStreams[v]}),l.apply(this,arguments)}}},{"../utils.js":11,"./getdisplaymedia":4,"./getusermedia":5}],4:[function(k,I,g){"use strict";Object.defineProperty(g,"__esModule",{value:!0}),g.shimGetDisplayMedia=function(u,a){if((!u.navigator.mediaDevices||!("getDisplayMedia"in u.navigator.mediaDevices))&&u.navigator.mediaDevices){if("function"!=typeof a)return void console.error("shimGetDisplayMedia: getSourceId argument is not a function");u.navigator.mediaDevices.getDisplayMedia=function(o){return a(o).then(function(f){var C=o.video&&o.video.width,R=o.video&&o.video.height;return o.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:f,maxFrameRate:o.video&&o.video.frameRate||3}},C&&(o.video.mandatory.maxWidth=C),R&&(o.video.mandatory.maxHeight=R),u.navigator.mediaDevices.getUserMedia(o)})}}}},{}],5:[function(k,I,g){"use strict";Object.defineProperty(g,"__esModule",{value:!0});var _="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(C){return typeof C}:function(C){return C&&"function"==typeof Symbol&&C.constructor===Symbol&&C!==Symbol.prototype?"symbol":typeof C};g.shimGetUserMedia=function(C,R){var T=C&&C.navigator;if(T.mediaDevices){var P=function(n){if("object"!==(void 0===n?"undefined":_(n))||n.mandatory||n.optional)return n;var e={};return Object.keys(n).forEach(function(t){if("require"!==t&&"advanced"!==t&&"mediaSource"!==t){var r="object"===_(n[t])?n[t]:{ideal:n[t]};void 0!==r.exact&&"number"==typeof r.exact&&(r.min=r.max=r.exact);var s=function(m,d){return m?m+d.charAt(0).toUpperCase()+d.slice(1):"deviceId"===d?"sourceId":d};if(void 0!==r.ideal){e.optional=e.optional||[];var l={};"number"==typeof r.ideal?(l[s("min",t)]=r.ideal,e.optional.push(l),(l={})[s("max",t)]=r.ideal,e.optional.push(l)):(l[s("",t)]=r.ideal,e.optional.push(l))}void 0!==r.exact&&"number"!=typeof r.exact?(e.mandatory=e.mandatory||{},e.mandatory[s("",t)]=r.exact):["min","max"].forEach(function(h){void 0!==r[h]&&(e.mandatory=e.mandatory||{},e.mandatory[s(h,t)]=r[h])})}}),n.advanced&&(e.optional=(e.optional||[]).concat(n.advanced)),e},x=function(n,e){if(R.version>=61)return e(n);if((n=JSON.parse(JSON.stringify(n)))&&"object"===_(n.audio)){var t=function(m,d,v){d in m&&!(v in m)&&(m[v]=m[d],delete m[d])};t((n=JSON.parse(JSON.stringify(n))).audio,"autoGainControl","googAutoGainControl"),t(n.audio,"noiseSuppression","googNoiseSuppression"),n.audio=P(n.audio)}if(n&&"object"===_(n.video)){var r=n.video.facingMode;r=r&&("object"===(void 0===r?"undefined":_(r))?r:{ideal:r});var s=R.version<66;if(r&&("user"===r.exact||"environment"===r.exact||"user"===r.ideal||"environment"===r.ideal)&&(!T.mediaDevices.getSupportedConstraints||!T.mediaDevices.getSupportedConstraints().facingMode||s)){delete n.video.facingMode;var l=void 0;if("environment"===r.exact||"environment"===r.ideal?l=["back","rear"]:("user"===r.exact||"user"===r.ideal)&&(l=["front"]),l)return T.mediaDevices.enumerateDevices().then(function(h){var m=(h=h.filter(function(d){return"videoinput"===d.kind})).find(function(d){return l.some(function(v){return d.label.toLowerCase().includes(v)})});return!m&&h.length&&l.includes("back")&&(m=h[h.length-1]),m&&(n.video.deviceId=r.exact?{exact:m.deviceId}:{ideal:m.deviceId}),n.video=P(n.video),o("chrome: "+JSON.stringify(n)),e(n)})}n.video=P(n.video)}return o("chrome: "+JSON.stringify(n)),e(n)},O=function(n){return R.version>=64?n:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[n.name]||n.name,message:n.message,constraint:n.constraint||n.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}};if(T.getUserMedia=function(n,e,t){x(n,function(r){T.webkitGetUserMedia(r,e,function(s){t&&t(O(s))})})}.bind(T),T.mediaDevices.getUserMedia){var p=T.mediaDevices.getUserMedia.bind(T.mediaDevices);T.mediaDevices.getUserMedia=function(c){return x(c,function(n){return p(n).then(function(e){if(n.audio&&!e.getAudioTracks().length||n.video&&!e.getVideoTracks().length)throw e.getTracks().forEach(function(t){t.stop()}),new DOMException("","NotFoundError");return e},function(e){return Promise.reject(O(e))})})}}}};var o=function(C){if(C&&C.__esModule)return C;var R={};if(null!=C)for(var T in C)Object.prototype.hasOwnProperty.call(C,T)&&(R[T]=C[T]);return R.default=C,R}(k("../utils.js")).log},{"../utils.js":11}],6:[function(k,I,g){"use strict";Object.defineProperty(g,"__esModule",{value:!0});var _="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(c){return typeof c}:function(c){return c&&"function"==typeof Symbol&&c.constructor===Symbol&&c!==Symbol.prototype?"symbol":typeof c};g.shimRTCIceCandidate=function(c){if(!(!c.RTCIceCandidate||c.RTCIceCandidate&&"foundation"in c.RTCIceCandidate.prototype)){var n=c.RTCIceCandidate;c.RTCIceCandidate=function(t){if("object"===(void 0===t?"undefined":_(t))&&t.candidate&&0===t.candidate.indexOf("a=")&&((t=JSON.parse(JSON.stringify(t))).candidate=t.candidate.substr(2)),t.candidate&&t.candidate.length){var r=new n(t),s=a.default.parseCandidate(t.candidate),l=Object.assign(r,s);return l.toJSON=function(){return{candidate:l.candidate,sdpMid:l.sdpMid,sdpMLineIndex:l.sdpMLineIndex,usernameFragment:l.usernameFragment}},l}return new n(t)},c.RTCIceCandidate.prototype=n.prototype,o.wrapPeerConnectionEvent(c,"icecandidate",function(e){return e.candidate&&Object.defineProperty(e,"candidate",{value:new c.RTCIceCandidate(e.candidate),writable:"false"}),e})}},g.shimMaxMessageSize=function(c,n){if(c.RTCPeerConnection){"sctp"in c.RTCPeerConnection.prototype||Object.defineProperty(c.RTCPeerConnection.prototype,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp}});var e=function(m){if(!m||!m.sdp)return!1;var d=a.default.splitSections(m.sdp);return d.shift(),d.some(function(v){var y=a.default.parseMLine(v);return y&&"application"===y.kind&&-1!==y.protocol.indexOf("SCTP")})},t=function(m){var d=m.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===d||d.length<2)return-1;var v=parseInt(d[1],10);return v!=v?-1:v},r=function(m){var d=65536;return"firefox"===n.browser&&(d=n.version<57?-1===m?16384:2147483637:n.version<60?57===n.version?65535:65536:2147483637),d},s=function(m,d){var v=65536;"firefox"===n.browser&&57===n.version&&(v=65535);var y=a.default.matchPrefix(m.sdp,"a=max-message-size:");return y.length>0?v=parseInt(y[0].substr(19),10):"firefox"===n.browser&&-1!==d&&(v=2147483637),v},l=c.RTCPeerConnection.prototype.setRemoteDescription;c.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===n.browser&&n.version>=76){var m=this.getConfiguration(),d=m.sdpSemantics;"plan-b"===d&&Object.defineProperty(this,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(e(arguments[0])){var v=t(arguments[0]),y=r(v),S=s(arguments[0],v),E=void 0;E=0===y&&0===S?Number.POSITIVE_INFINITY:0===y||0===S?Math.max(y,S):Math.min(y,S);var b={};Object.defineProperty(b,"maxMessageSize",{get:function(){return E}}),this._sctp=b}return l.apply(this,arguments)}}},g.shimSendThrowTypeError=function(c){if(c.RTCPeerConnection&&"createDataChannel"in c.RTCPeerConnection.prototype){var e=c.RTCPeerConnection.prototype.createDataChannel;c.RTCPeerConnection.prototype.createDataChannel=function(){var r=e.apply(this,arguments);return n(r,this),r},o.wrapPeerConnectionEvent(c,"datachannel",function(t){return n(t.channel,t.target),t})}function n(t,r){var s=t.send;t.send=function(){var h=arguments[0],m=h.length||h.size||h.byteLength;if("open"===t.readyState&&r.sctp&&m>r.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+r.sctp.maxMessageSize+" bytes)");return s.apply(t,arguments)}}},g.shimConnectionState=function(c){if(c.RTCPeerConnection&&!("connectionState"in c.RTCPeerConnection.prototype)){var n=c.RTCPeerConnection.prototype;Object.defineProperty(n,"connectionState",{get:function(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(n,"onconnectionstatechange",{get:function(){return this._onconnectionstatechange||null},set:function(t){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),t&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=t)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(function(e){var t=n[e];n[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=function(r){var s=r.target;if(s._lastConnectionState!==s.connectionState){s._lastConnectionState=s.connectionState;var l=new Event("connectionstatechange",r);s.dispatchEvent(l)}return r},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),t.apply(this,arguments)}})}},g.removeExtmapAllowMixed=function(c,n){if(c.RTCPeerConnection&&!("chrome"===n.browser&&n.version>=71)&&!("safari"===n.browser&&n.version>=605)){var e=c.RTCPeerConnection.prototype.setRemoteDescription;c.RTCPeerConnection.prototype.setRemoteDescription=function(r){if(r&&r.sdp&&-1!==r.sdp.indexOf("\na=extmap-allow-mixed")){var s=r.sdp.split("\n").filter(function(l){return"a=extmap-allow-mixed"!==l.trim()}).join("\n");c.RTCSessionDescription&&r instanceof c.RTCSessionDescription?arguments[0]=new c.RTCSessionDescription({type:r.type,sdp:s}):r.sdp=s}return e.apply(this,arguments)}}},g.shimAddIceCandidateNullOrEmpty=function(c,n){if(c.RTCPeerConnection&&c.RTCPeerConnection.prototype){var e=c.RTCPeerConnection.prototype.addIceCandidate;!e||0===e.length||(c.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===n.browser&&n.version<78||"firefox"===n.browser&&n.version<68||"safari"===n.browser)&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():e.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}},g.shimParameterlessSetLocalDescription=function(c,n){if(c.RTCPeerConnection&&c.RTCPeerConnection.prototype){var e=c.RTCPeerConnection.prototype.setLocalDescription;!e||0===e.length||(c.RTCPeerConnection.prototype.setLocalDescription=function(){var r=this,s=arguments[0]||{};if("object"!==(void 0===s?"undefined":_(s))||s.type&&s.sdp)return e.apply(this,arguments);if(!(s={type:s.type,sdp:s.sdp}).type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":s.type="offer";break;default:s.type="answer"}if(s.sdp||"offer"!==s.type&&"answer"!==s.type)return e.apply(this,[s]);var l="offer"===s.type?this.createOffer:this.createAnswer;return l.apply(this).then(function(h){return e.apply(r,[h])})})}};var c,a=(c=k("sdp"))&&c.__esModule?c:{default:c},o=function(c){if(c&&c.__esModule)return c;var n={};if(null!=c)for(var e in c)Object.prototype.hasOwnProperty.call(c,e)&&(n[e]=c[e]);return n.default=c,n}(k("./utils"))},{"./utils":11,sdp:12}],7:[function(k,I,g){"use strict";Object.defineProperty(g,"__esModule",{value:!0}),g.shimGetDisplayMedia=g.shimGetUserMedia=void 0;var _="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},u=k("./getusermedia");Object.defineProperty(g,"shimGetUserMedia",{enumerable:!0,get:function(){return u.shimGetUserMedia}});var a=k("./getdisplaymedia");Object.defineProperty(g,"shimGetDisplayMedia",{enumerable:!0,get:function(){return a.shimGetDisplayMedia}}),g.shimOnTrack=function(t){"object"===(void 0===t?"undefined":_(t))&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},g.shimPeerConnection=function(t,r){if("object"===(void 0===t?"undefined":_(t))&&(t.RTCPeerConnection||t.mozRTCPeerConnection)){!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),r.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(h){var m=t.RTCPeerConnection.prototype[h],d=function(t,r,s){return r in t?Object.defineProperty(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}({},h,function(){return arguments[0]=new("addIceCandidate"===h?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),m.apply(this,arguments)});t.RTCPeerConnection.prototype[h]=d[h]});var s={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},l=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){var m=Array.prototype.slice.call(arguments),d=m[0],v=m[1],y=m[2];return l.apply(this,[d||null]).then(function(S){if(r.version<53&&!v)try{S.forEach(function(E){E.type=s[E.type]||E.type})}catch(E){if("TypeError"!==E.name)throw E;S.forEach(function(b,D){S.set(D,Object.assign({},b,{type:s[b.type]||b.type}))})}return S}).then(v,y)}}},g.shimSenderGetStats=function(t){if("object"===(void 0===t?"undefined":_(t))&&t.RTCPeerConnection&&t.RTCRtpSender&&(!t.RTCRtpSender||!("getStats"in t.RTCRtpSender.prototype))){var r=t.RTCPeerConnection.prototype.getSenders;r&&(t.RTCPeerConnection.prototype.getSenders=function(){var h=this,m=r.apply(this,[]);return m.forEach(function(d){return d._pc=h}),m});var s=t.RTCPeerConnection.prototype.addTrack;s&&(t.RTCPeerConnection.prototype.addTrack=function(){var h=s.apply(this,arguments);return h._pc=this,h}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}},g.shimReceiverGetStats=function(t){if("object"===(void 0===t?"undefined":_(t))&&t.RTCPeerConnection&&t.RTCRtpSender&&(!t.RTCRtpSender||!("getStats"in t.RTCRtpReceiver.prototype))){var r=t.RTCPeerConnection.prototype.getReceivers;r&&(t.RTCPeerConnection.prototype.getReceivers=function(){var l=this,h=r.apply(this,[]);return h.forEach(function(m){return m._pc=l}),h}),o.wrapPeerConnectionEvent(t,"track",function(s){return s.receiver._pc=s.srcElement,s}),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}},g.shimRemoveStream=function(t){!t.RTCPeerConnection||"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(s){var l=this;o.deprecated("removeStream","removeTrack"),this.getSenders().forEach(function(h){h.track&&s.getTracks().includes(h.track)&&l.removeTrack(h)})})},g.shimRTCDataChannel=function(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)},g.shimAddTransceiver=function(t){if("object"===(void 0===t?"undefined":_(t))&&t.RTCPeerConnection){var r=t.RTCPeerConnection.prototype.addTransceiver;r&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];var l=arguments[1],h=l&&"sendEncodings"in l;h&&l.sendEncodings.forEach(function(y){if("rid"in y&&!/^[a-z0-9]{0,16}$/i.test(y.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in y&&!(parseFloat(y.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in y&&!(parseFloat(y.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});var m=r.apply(this,arguments);if(h){var d=m.sender,v=d.getParameters();(!("encodings"in v)||1===v.encodings.length&&0===Object.keys(v.encodings[0]).length)&&(v.encodings=l.sendEncodings,d.sendEncodings=l.sendEncodings,this.setParametersPromises.push(d.setParameters(v).then(function(){delete d.sendEncodings}).catch(function(){delete d.sendEncodings})))}return m})}},g.shimGetParameters=function(t){if("object"===(void 0===t?"undefined":_(t))&&t.RTCRtpSender){var r=t.RTCRtpSender.prototype.getParameters;r&&(t.RTCRtpSender.prototype.getParameters=function(){var l=r.apply(this,arguments);return"encodings"in l||(l.encodings=[].concat(this.sendEncodings||[{}])),l})}},g.shimCreateOffer=function(t){if("object"===(void 0===t?"undefined":_(t))&&t.RTCPeerConnection){var r=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){var l=this,h=arguments;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(function(){return r.apply(l,h)}).finally(function(){l.setParametersPromises=[]}):r.apply(this,arguments)}}},g.shimCreateAnswer=function(t){if("object"===(void 0===t?"undefined":_(t))&&t.RTCPeerConnection){var r=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){var l=this,h=arguments;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(function(){return r.apply(l,h)}).finally(function(){l.setParametersPromises=[]}):r.apply(this,arguments)}}};var o=function(t){if(t&&t.__esModule)return t;var r={};if(null!=t)for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(r[s]=t[s]);return r.default=t,r}(k("../utils"))},{"../utils":11,"./getdisplaymedia":8,"./getusermedia":9}],8:[function(k,I,g){"use strict";Object.defineProperty(g,"__esModule",{value:!0}),g.shimGetDisplayMedia=function(u,a){u.navigator.mediaDevices&&"getDisplayMedia"in u.navigator.mediaDevices||!u.navigator.mediaDevices||(u.navigator.mediaDevices.getDisplayMedia=function(o){if(!o||!o.video){var f=new DOMException("getDisplayMedia without video constraints is undefined");return f.name="NotFoundError",f.code=8,Promise.reject(f)}return!0===o.video?o.video={mediaSource:a}:o.video.mediaSource=a,u.navigator.mediaDevices.getUserMedia(o)})}},{}],9:[function(k,I,g){"use strict";Object.defineProperty(g,"__esModule",{value:!0});var _="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(f){return typeof f}:function(f){return f&&"function"==typeof Symbol&&f.constructor===Symbol&&f!==Symbol.prototype?"symbol":typeof f};g.shimGetUserMedia=function(f,C){var R=f&&f.navigator,T=f&&f.MediaStreamTrack;if(R.getUserMedia=function(p,c,n){a.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),R.mediaDevices.getUserMedia(p).then(c,n)},!(C.version>55&&"autoGainControl"in R.mediaDevices.getSupportedConstraints())){var P=function(c,n,e){n in c&&!(e in c)&&(c[e]=c[n],delete c[n])},x=R.mediaDevices.getUserMedia.bind(R.mediaDevices);if(R.mediaDevices.getUserMedia=function(p){return"object"===(void 0===p?"undefined":_(p))&&"object"===_(p.audio)&&(p=JSON.parse(JSON.stringify(p)),P(p.audio,"autoGainControl","mozAutoGainControl"),P(p.audio,"noiseSuppression","mozNoiseSuppression")),x(p)},T&&T.prototype.getSettings){var O=T.prototype.getSettings;T.prototype.getSettings=function(){var p=O.apply(this,arguments);return P(p,"mozAutoGainControl","autoGainControl"),P(p,"mozNoiseSuppression","noiseSuppression"),p}}if(T&&T.prototype.applyConstraints){var M=T.prototype.applyConstraints;T.prototype.applyConstraints=function(p){return"audio"===this.kind&&"object"===(void 0===p?"undefined":_(p))&&(p=JSON.parse(JSON.stringify(p)),P(p,"autoGainControl","mozAutoGainControl"),P(p,"noiseSuppression","mozNoiseSuppression")),M.apply(this,[p])}}}};var a=function(f){if(f&&f.__esModule)return f;var C={};if(null!=f)for(var R in f)Object.prototype.hasOwnProperty.call(f,R)&&(C[R]=f[R]);return C.default=f,C}(k("../utils"))},{"../utils":11}],10:[function(k,I,g){"use strict";Object.defineProperty(g,"__esModule",{value:!0});var _="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(p){return typeof p}:function(p){return p&&"function"==typeof Symbol&&p.constructor===Symbol&&p!==Symbol.prototype?"symbol":typeof p};g.shimLocalStreamsAPI=function(p){if("object"===(void 0===p?"undefined":_(p))&&p.RTCPeerConnection){if("getLocalStreams"in p.RTCPeerConnection.prototype||(p.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in p.RTCPeerConnection.prototype)){var c=p.RTCPeerConnection.prototype.addTrack;p.RTCPeerConnection.prototype.addStream=function(e){var t=this;this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getAudioTracks().forEach(function(r){return c.call(t,r,e)}),e.getVideoTracks().forEach(function(r){return c.call(t,r,e)})},p.RTCPeerConnection.prototype.addTrack=function(e){for(var t=this,r=arguments.length,s=Array(r>1?r-1:0),l=1;l<r;l++)s[l-1]=arguments[l];return s&&s.forEach(function(h){t._localStreams?t._localStreams.includes(h)||t._localStreams.push(h):t._localStreams=[h]}),c.apply(this,arguments)}}"removeStream"in p.RTCPeerConnection.prototype||(p.RTCPeerConnection.prototype.removeStream=function(e){var t=this;this._localStreams||(this._localStreams=[]);var r=this._localStreams.indexOf(e);if(-1!==r){this._localStreams.splice(r,1);var s=e.getTracks();this.getSenders().forEach(function(l){s.includes(l.track)&&t.removeTrack(l)})}})}},g.shimRemoteStreamsAPI=function(p){if("object"===(void 0===p?"undefined":_(p))&&p.RTCPeerConnection&&("getRemoteStreams"in p.RTCPeerConnection.prototype||(p.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in p.RTCPeerConnection.prototype))){Object.defineProperty(p.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(e){var t=this;this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=function(r){r.streams.forEach(function(s){if(t._remoteStreams||(t._remoteStreams=[]),!t._remoteStreams.includes(s)){t._remoteStreams.push(s);var l=new Event("addstream");l.stream=s,t.dispatchEvent(l)}})})}});var c=p.RTCPeerConnection.prototype.setRemoteDescription;p.RTCPeerConnection.prototype.setRemoteDescription=function(){var e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach(function(r){if(e._remoteStreams||(e._remoteStreams=[]),!(e._remoteStreams.indexOf(r)>=0)){e._remoteStreams.push(r);var s=new Event("addstream");s.stream=r,e.dispatchEvent(s)}})}),c.apply(e,arguments)}}},g.shimCallbacksAPI=function(p){if("object"===(void 0===p?"undefined":_(p))&&p.RTCPeerConnection){var c=p.RTCPeerConnection.prototype,n=c.createOffer,e=c.createAnswer,t=c.setLocalDescription,r=c.setRemoteDescription,s=c.addIceCandidate;c.createOffer=function(m,d){var v=arguments.length>=2?arguments[2]:arguments[0],y=n.apply(this,[v]);return d?(y.then(m,d),Promise.resolve()):y},c.createAnswer=function(m,d){var v=arguments.length>=2?arguments[2]:arguments[0],y=e.apply(this,[v]);return d?(y.then(m,d),Promise.resolve()):y};var l=function(m,d,v){var y=t.apply(this,[m]);return v?(y.then(d,v),Promise.resolve()):y};c.setLocalDescription=l,c.setRemoteDescription=l=function(m,d,v){var y=r.apply(this,[m]);return v?(y.then(d,v),Promise.resolve()):y},c.addIceCandidate=l=function(m,d,v){var y=s.apply(this,[m]);return v?(y.then(d,v),Promise.resolve()):y}}},g.shimGetUserMedia=function(p){var c=p&&p.navigator;if(c.mediaDevices&&c.mediaDevices.getUserMedia){var n=c.mediaDevices,e=n.getUserMedia.bind(n);c.mediaDevices.getUserMedia=function(t){return e(T(t))}}!c.getUserMedia&&c.mediaDevices&&c.mediaDevices.getUserMedia&&(c.getUserMedia=function(r,s,l){c.mediaDevices.getUserMedia(r).then(s,l)}.bind(c))},g.shimConstraints=T,g.shimRTCIceServerUrls=function(p){if(p.RTCPeerConnection){var c=p.RTCPeerConnection;p.RTCPeerConnection=function(e,t){if(e&&e.iceServers){for(var r=[],s=0;s<e.iceServers.length;s++){var l=e.iceServers[s];!l.hasOwnProperty("urls")&&l.hasOwnProperty("url")?(a.deprecated("RTCIceServer.url","RTCIceServer.urls"),(l=JSON.parse(JSON.stringify(l))).urls=l.url,delete l.url,r.push(l)):r.push(e.iceServers[s])}e.iceServers=r}return new c(e,t)},p.RTCPeerConnection.prototype=c.prototype,"generateCertificate"in c&&Object.defineProperty(p.RTCPeerConnection,"generateCertificate",{get:function(){return c.generateCertificate}})}},g.shimTrackEventTransceiver=function(p){"object"===(void 0===p?"undefined":_(p))&&p.RTCTrackEvent&&"receiver"in p.RTCTrackEvent.prototype&&!("transceiver"in p.RTCTrackEvent.prototype)&&Object.defineProperty(p.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},g.shimCreateOfferLegacy=function(p){var c=p.RTCPeerConnection.prototype.createOffer;p.RTCPeerConnection.prototype.createOffer=function(e){if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);var t=this.getTransceivers().find(function(s){return"audio"===s.receiver.track.kind});!1===e.offerToReceiveAudio&&t?"sendrecv"===t.direction?t.setDirection?t.setDirection("sendonly"):t.direction="sendonly":"recvonly"===t.direction&&(t.setDirection?t.setDirection("inactive"):t.direction="inactive"):!0===e.offerToReceiveAudio&&!t&&this.addTransceiver("audio",{direction:"recvonly"}),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);var r=this.getTransceivers().find(function(s){return"video"===s.receiver.track.kind});!1===e.offerToReceiveVideo&&r?"sendrecv"===r.direction?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":"recvonly"===r.direction&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):!0===e.offerToReceiveVideo&&!r&&this.addTransceiver("video",{direction:"recvonly"})}return c.apply(this,arguments)}},g.shimAudioContext=function(p){"object"!==(void 0===p?"undefined":_(p))||p.AudioContext||(p.AudioContext=p.webkitAudioContext)};var a=function(p){if(p&&p.__esModule)return p;var c={};if(null!=p)for(var n in p)Object.prototype.hasOwnProperty.call(p,n)&&(c[n]=p[n]);return c.default=p,c}(k("../utils"));function T(p){return p&&void 0!==p.video?Object.assign({},p,{video:a.compactObject(p.video)}):p}},{"../utils":11}],11:[function(k,I,g){"use strict";Object.defineProperty(g,"__esModule",{value:!0});var _="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n};g.extractVersion=o,g.wrapPeerConnectionEvent=function(n,e,t){if(n.RTCPeerConnection){var r=n.RTCPeerConnection.prototype,s=r.addEventListener;r.addEventListener=function(h,m){if(h!==e)return s.apply(this,arguments);var d=function(y){var S=t(y);S&&(m.handleEvent?m.handleEvent(S):m(S))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(m,d),s.apply(this,[h,d])};var l=r.removeEventListener;r.removeEventListener=function(h,m){if(h!==e||!this._eventMap||!this._eventMap[e])return l.apply(this,arguments);if(!this._eventMap[e].has(m))return l.apply(this,arguments);var d=this._eventMap[e].get(m);return this._eventMap[e].delete(m),0===this._eventMap[e].size&&delete this._eventMap[e],0===Object.keys(this._eventMap).length&&delete this._eventMap,l.apply(this,[h,d])},Object.defineProperty(r,"on"+e,{get:function(){return this["_on"+e]},set:function(m){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),m&&this.addEventListener(e,this["_on"+e]=m)},enumerable:!0,configurable:!0})}},g.disableLog=function(n){return"boolean"!=typeof n?new Error("Argument type: "+(void 0===n?"undefined":_(n))+". Please use a boolean."):(a=n,n?"adapter.js logging disabled":"adapter.js logging enabled")},g.disableWarnings=function(n){return"boolean"!=typeof n?new Error("Argument type: "+(void 0===n?"undefined":_(n))+". Please use a boolean."):(i=!n,"adapter.js deprecation warnings "+(n?"disabled":"enabled"))},g.log=function(){if("object"===("undefined"==typeof window?"undefined":_(window))){if(a)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}},g.deprecated=function(n,e){!i||console.warn(n+" is deprecated, please use "+e+" instead.")},g.detectBrowser=function(n){var e={browser:null,version:null};if(void 0===n||!n.navigator)return e.browser="Not a browser.",e;var t=n.navigator;if(t.mozGetUserMedia)e.browser="firefox",e.version=o(t.userAgent,/Firefox\/(\d+)\./,1);else if(t.webkitGetUserMedia||!1===n.isSecureContext&&n.webkitRTCPeerConnection&&!n.RTCIceGatherer)e.browser="chrome",e.version=o(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!n.RTCPeerConnection||!t.userAgent.match(/AppleWebKit\/(\d+)\./))return e.browser="Not a supported browser.",e;e.browser="safari",e.version=o(t.userAgent,/AppleWebKit\/(\d+)\./,1),e.supportsUnifiedPlan=n.RTCRtpTransceiver&&"currentDirection"in n.RTCRtpTransceiver.prototype}return e},g.compactObject=function M(n){return O(n)?Object.keys(n).reduce(function(e,t){var r=O(n[t]),s=r?M(n[t]):n[t],l=r&&!Object.keys(s).length;return void 0===s||l?e:Object.assign(e,function(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}({},t,s))},{}):n},g.walkStats=p,g.filterStats=function(n,e,t){var r=t?"outbound-rtp":"inbound-rtp",s=new Map;if(null===e)return s;var l=[];return n.forEach(function(h){"track"===h.type&&h.trackIdentifier===e.id&&l.push(h)}),l.forEach(function(h){n.forEach(function(m){m.type===r&&m.trackId===h.id&&p(n,m,s)})}),s};var a=!0,i=!0;function o(n,e,t){var r=n.match(e);return r&&r.length>=t&&parseInt(r[t],10)}function O(n){return"[object Object]"===Object.prototype.toString.call(n)}function p(n,e,t){!e||t.has(e.id)||(t.set(e.id,e),Object.keys(e).forEach(function(r){r.endsWith("Id")?p(n,n.get(e[r]),t):r.endsWith("Ids")&&e[r].forEach(function(s){p(n,n.get(s),t)})}))}},{}],12:[function(k,I,g){"use strict";var _="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},u={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};u.localCName=u.generateIdentifier(),u.splitLines=function(a){return a.trim().split("\n").map(function(i){return i.trim()})},u.splitSections=function(a){return a.split("\nm=").map(function(o,f){return(f>0?"m="+o:o).trim()+"\r\n"})},u.getDescription=function(a){var i=u.splitSections(a);return i&&i[0]},u.getMediaSections=function(a){var i=u.splitSections(a);return i.shift(),i},u.matchPrefix=function(a,i){return u.splitLines(a).filter(function(o){return 0===o.indexOf(i)})},u.parseCandidate=function(a){for(var i=void 0,o={foundation:(i=0===a.indexOf("a=candidate:")?a.substring(12).split(" "):a.substring(10).split(" "))[0],component:{1:"rtp",2:"rtcp"}[i[1]]||i[1],protocol:i[2].toLowerCase(),priority:parseInt(i[3],10),ip:i[4],address:i[4],port:parseInt(i[5],10),type:i[7]},f=8;f<i.length;f+=2)switch(i[f]){case"raddr":o.relatedAddress=i[f+1];break;case"rport":o.relatedPort=parseInt(i[f+1],10);break;case"tcptype":o.tcpType=i[f+1];break;case"ufrag":o.ufrag=i[f+1],o.usernameFragment=i[f+1];break;default:void 0===o[i[f]]&&(o[i[f]]=i[f+1])}return o},u.writeCandidate=function(a){var i=[];i.push(a.foundation);var o=a.component;i.push("rtp"===o?1:"rtcp"===o?2:o),i.push(a.protocol.toUpperCase()),i.push(a.priority),i.push(a.address||a.ip),i.push(a.port);var f=a.type;return i.push("typ"),i.push(f),"host"!==f&&a.relatedAddress&&a.relatedPort&&(i.push("raddr"),i.push(a.relatedAddress),i.push("rport"),i.push(a.relatedPort)),a.tcpType&&"tcp"===a.protocol.toLowerCase()&&(i.push("tcptype"),i.push(a.tcpType)),(a.usernameFragment||a.ufrag)&&(i.push("ufrag"),i.push(a.usernameFragment||a.ufrag)),"candidate:"+i.join(" ")},u.parseIceOptions=function(a){return a.substr(14).split(" ")},u.parseRtpMap=function(a){var i=a.substr(9).split(" "),o={payloadType:parseInt(i.shift(),10)};return i=i[0].split("/"),o.name=i[0],o.clockRate=parseInt(i[1],10),o.channels=3===i.length?parseInt(i[2],10):1,o.numChannels=o.channels,o},u.writeRtpMap=function(a){var i=a.payloadType;void 0!==a.preferredPayloadType&&(i=a.preferredPayloadType);var o=a.channels||a.numChannels||1;return"a=rtpmap:"+i+" "+a.name+"/"+a.clockRate+(1!==o?"/"+o:"")+"\r\n"},u.parseExtmap=function(a){var i=a.substr(9).split(" ");return{id:parseInt(i[0],10),direction:i[0].indexOf("/")>0?i[0].split("/")[1]:"sendrecv",uri:i[1]}},u.writeExtmap=function(a){return"a=extmap:"+(a.id||a.preferredId)+(a.direction&&"sendrecv"!==a.direction?"/"+a.direction:"")+" "+a.uri+"\r\n"},u.parseFmtp=function(a){for(var i={},o=void 0,f=a.substr(a.indexOf(" ")+1).split(";"),C=0;C<f.length;C++)i[(o=f[C].trim().split("="))[0].trim()]=o[1];return i},u.writeFmtp=function(a){var i="",o=a.payloadType;if(void 0!==a.preferredPayloadType&&(o=a.preferredPayloadType),a.parameters&&Object.keys(a.parameters).length){var f=[];Object.keys(a.parameters).forEach(function(C){f.push(void 0!==a.parameters[C]?C+"="+a.parameters[C]:C)}),i+="a=fmtp:"+o+" "+f.join(";")+"\r\n"}return i},u.parseRtcpFb=function(a){var i=a.substr(a.indexOf(" ")+1).split(" ");return{type:i.shift(),parameter:i.join(" ")}},u.writeRtcpFb=function(a){var i="",o=a.payloadType;return void 0!==a.preferredPayloadType&&(o=a.preferredPayloadType),a.rtcpFeedback&&a.rtcpFeedback.length&&a.rtcpFeedback.forEach(function(f){i+="a=rtcp-fb:"+o+" "+f.type+(f.parameter&&f.parameter.length?" "+f.parameter:"")+"\r\n"}),i},u.parseSsrcMedia=function(a){var i=a.indexOf(" "),o={ssrc:parseInt(a.substr(7,i-7),10)},f=a.indexOf(":",i);return f>-1?(o.attribute=a.substr(i+1,f-i-1),o.value=a.substr(f+1)):o.attribute=a.substr(i+1),o},u.parseSsrcGroup=function(a){var i=a.substr(13).split(" ");return{semantics:i.shift(),ssrcs:i.map(function(o){return parseInt(o,10)})}},u.getMid=function(a){var i=u.matchPrefix(a,"a=mid:")[0];if(i)return i.substr(6)},u.parseFingerprint=function(a){var i=a.substr(14).split(" ");return{algorithm:i[0].toLowerCase(),value:i[1].toUpperCase()}},u.getDtlsParameters=function(a,i){return{role:"auto",fingerprints:u.matchPrefix(a+i,"a=fingerprint:").map(u.parseFingerprint)}},u.writeDtlsParameters=function(a,i){var o="a=setup:"+i+"\r\n";return a.fingerprints.forEach(function(f){o+="a=fingerprint:"+f.algorithm+" "+f.value+"\r\n"}),o},u.parseCryptoLine=function(a){var i=a.substr(9).split(" ");return{tag:parseInt(i[0],10),cryptoSuite:i[1],keyParams:i[2],sessionParams:i.slice(3)}},u.writeCryptoLine=function(a){return"a=crypto:"+a.tag+" "+a.cryptoSuite+" "+("object"===_(a.keyParams)?u.writeCryptoKeyParams(a.keyParams):a.keyParams)+(a.sessionParams?" "+a.sessionParams.join(" "):"")+"\r\n"},u.parseCryptoKeyParams=function(a){if(0!==a.indexOf("inline:"))return null;var i=a.substr(7).split("|");return{keyMethod:"inline",keySalt:i[0],lifeTime:i[1],mkiValue:i[2]?i[2].split(":")[0]:void 0,mkiLength:i[2]?i[2].split(":")[1]:void 0}},u.writeCryptoKeyParams=function(a){return a.keyMethod+":"+a.keySalt+(a.lifeTime?"|"+a.lifeTime:"")+(a.mkiValue&&a.mkiLength?"|"+a.mkiValue+":"+a.mkiLength:"")},u.getCryptoParameters=function(a,i){return u.matchPrefix(a+i,"a=crypto:").map(u.parseCryptoLine)},u.getIceParameters=function(a,i){var o=u.matchPrefix(a+i,"a=ice-ufrag:")[0],f=u.matchPrefix(a+i,"a=ice-pwd:")[0];return o&&f?{usernameFragment:o.substr(12),password:f.substr(10)}:null},u.writeIceParameters=function(a){var i="a=ice-ufrag:"+a.usernameFragment+"\r\na=ice-pwd:"+a.password+"\r\n";return a.iceLite&&(i+="a=ice-lite\r\n"),i},u.parseRtpParameters=function(a){for(var i={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},f=u.splitLines(a)[0].split(" "),C=3;C<f.length;C++){var R=f[C],T=u.matchPrefix(a,"a=rtpmap:"+R+" ")[0];if(T){var P=u.parseRtpMap(T),x=u.matchPrefix(a,"a=fmtp:"+R+" ");switch(P.parameters=x.length?u.parseFmtp(x[0]):{},P.rtcpFeedback=u.matchPrefix(a,"a=rtcp-fb:"+R+" ").map(u.parseRtcpFb),i.codecs.push(P),P.name.toUpperCase()){case"RED":case"ULPFEC":i.fecMechanisms.push(P.name.toUpperCase())}}}return u.matchPrefix(a,"a=extmap:").forEach(function(O){i.headerExtensions.push(u.parseExtmap(O))}),i},u.writeRtpDescription=function(a,i){var o="";o+="m="+a+" ",o+=i.codecs.length>0?"9":"0",o+=" UDP/TLS/RTP/SAVPF ",o+=i.codecs.map(function(C){return void 0!==C.preferredPayloadType?C.preferredPayloadType:C.payloadType}).join(" ")+"\r\n",o+="c=IN IP4 0.0.0.0\r\n",o+="a=rtcp:9 IN IP4 0.0.0.0\r\n",i.codecs.forEach(function(C){o+=u.writeRtpMap(C),o+=u.writeFmtp(C),o+=u.writeRtcpFb(C)});var f=0;return i.codecs.forEach(function(C){C.maxptime>f&&(f=C.maxptime)}),f>0&&(o+="a=maxptime:"+f+"\r\n"),i.headerExtensions&&i.headerExtensions.forEach(function(C){o+=u.writeExtmap(C)}),o},u.parseRtpEncodingParameters=function(a){var i=[],o=u.parseRtpParameters(a),f=-1!==o.fecMechanisms.indexOf("RED"),C=-1!==o.fecMechanisms.indexOf("ULPFEC"),R=u.matchPrefix(a,"a=ssrc:").map(function(M){return u.parseSsrcMedia(M)}).filter(function(M){return"cname"===M.attribute}),T=R.length>0&&R[0].ssrc,P=void 0,x=u.matchPrefix(a,"a=ssrc-group:FID").map(function(M){return M.substr(17).split(" ").map(function(c){return parseInt(c,10)})});x.length>0&&x[0].length>1&&x[0][0]===T&&(P=x[0][1]),o.codecs.forEach(function(M){if("RTX"===M.name.toUpperCase()&&M.parameters.apt){var p={ssrc:T,codecPayloadType:parseInt(M.parameters.apt,10)};T&&P&&(p.rtx={ssrc:P}),i.push(p),f&&((p=JSON.parse(JSON.stringify(p))).fec={ssrc:T,mechanism:C?"red+ulpfec":"red"},i.push(p))}}),0===i.length&&T&&i.push({ssrc:T});var O=u.matchPrefix(a,"b=");return O.length&&(O=0===O[0].indexOf("b=TIAS:")?parseInt(O[0].substr(7),10):0===O[0].indexOf("b=AS:")?1e3*parseInt(O[0].substr(5),10)*.95-16e3:void 0,i.forEach(function(M){M.maxBitrate=O})),i},u.parseRtcpParameters=function(a){var i={},o=u.matchPrefix(a,"a=ssrc:").map(function(R){return u.parseSsrcMedia(R)}).filter(function(R){return"cname"===R.attribute})[0];o&&(i.cname=o.value,i.ssrc=o.ssrc);var f=u.matchPrefix(a,"a=rtcp-rsize");i.reducedSize=f.length>0,i.compound=0===f.length;var C=u.matchPrefix(a,"a=rtcp-mux");return i.mux=C.length>0,i},u.writeRtcpParameters=function(a){var i="";return a.reducedSize&&(i+="a=rtcp-rsize\r\n"),a.mux&&(i+="a=rtcp-mux\r\n"),void 0!==a.ssrc&&a.cname&&(i+="a=ssrc:"+a.ssrc+" cname:"+a.cname+"\r\n"),i},u.parseMsid=function(a){var i=void 0,o=u.matchPrefix(a,"a=msid:");if(1===o.length)return{stream:(i=o[0].substr(7).split(" "))[0],track:i[1]};var f=u.matchPrefix(a,"a=ssrc:").map(function(C){return u.parseSsrcMedia(C)}).filter(function(C){return"msid"===C.attribute});return f.length>0?{stream:(i=f[0].value.split(" "))[0],track:i[1]}:void 0},u.parseSctpDescription=function(a){var i=u.parseMLine(a),o=u.matchPrefix(a,"a=max-message-size:"),f=void 0;o.length>0&&(f=parseInt(o[0].substr(19),10)),isNaN(f)&&(f=65536);var C=u.matchPrefix(a,"a=sctp-port:");if(C.length>0)return{port:parseInt(C[0].substr(12),10),protocol:i.fmt,maxMessageSize:f};var R=u.matchPrefix(a,"a=sctpmap:");if(R.length>0){var T=R[0].substr(10).split(" ");return{port:parseInt(T[0],10),protocol:T[1],maxMessageSize:f}}},u.writeSctpDescription=function(a,i){var o=[];return o="DTLS/SCTP"!==a.protocol?["m="+a.kind+" 9 "+a.protocol+" "+i.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+i.port+"\r\n"]:["m="+a.kind+" 9 "+a.protocol+" "+i.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+i.port+" "+i.protocol+" 65535\r\n"],void 0!==i.maxMessageSize&&o.push("a=max-message-size:"+i.maxMessageSize+"\r\n"),o.join("")},u.generateSessionId=function(){return Math.random().toString().substr(2,21)},u.writeSessionBoilerplate=function(a,i,o){var C=void 0!==i?i:2;return"v=0\r\no="+(o||"thisisadapterortc")+" "+(a||u.generateSessionId())+" "+C+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},u.getDirection=function(a,i){for(var o=u.splitLines(a),f=0;f<o.length;f++)switch(o[f]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return o[f].substr(2)}return i?u.getDirection(i):"sendrecv"},u.getKind=function(a){return u.splitLines(a)[0].split(" ")[0].substr(2)},u.isRejected=function(a){return"0"===a.split(" ",2)[1]},u.parseMLine=function(a){var o=u.splitLines(a)[0].substr(2).split(" ");return{kind:o[0],port:parseInt(o[1],10),protocol:o[2],fmt:o.slice(3).join(" ")}},u.parseOLine=function(a){var o=u.matchPrefix(a,"o=")[0].substr(2).split(" ");return{username:o[0],sessionId:o[1],sessionVersion:parseInt(o[2],10),netType:o[3],addressType:o[4],address:o[5]}},u.isValidSDP=function(a){if("string"!=typeof a||0===a.length)return!1;for(var i=u.splitLines(a),o=0;o<i.length;o++)if(i[o].length<2||"="!==i[o].charAt(1))return!1;return!0},"object"===(void 0===I?"undefined":_(I))&&(I.exports=u)},{}]},{},[1])(1)});